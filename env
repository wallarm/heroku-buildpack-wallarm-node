#!/bin/sh

export LD_LIBRARY_PATH=/app/wallarm/lib:/app/wallarm/lib/python2.7/config-x86_64-linux-gnu
export RUBYLIB=/app/wallarm/lib/ruby/vendor_ruby
if grep -q "VERSION_CODENAME=bionic" /etc/os-release; then
	export RUBYLIB=$RUBYLIB:/app/wallarm/lib/ruby/vendor_ruby/2.5.0:/app/wallarm/share/rubygems-integration/all/gems/mime-types-3.1/lib/
elif grep -q "VERSION_CODENAME=xenial" /etc/os-release; then
	export RUBYLIB=$RUBYLIB:/app/wallarm/lib/ruby/vendor_ruby/2.3.0:
fi

export PYTHONPATH=/app/wallarm/lib/python2.7/dist-packages
export LUA_CPATH="/app/wallarm/lib/tarantool/?.so"
export LUA_PATH="/app/wallarm/share/tarantool/?.lua;/app/wallarm/share/tarantool/?/init.lua"

export WALLARM_DIR=/app/wallarm

export LOGDIR=${WALLARM_DIR}/logs
export CONFDIR=${WALLARM_DIR}/etc
export COMMON_DIR=${WALLARM_DIR}/share/wallarm-common
export BINDIR=${WALLARM_DIR}/bin
export SBINDIR=${WALLARM_DIR}/sbin
export MODULES_DIR=${WALLARM_DIR}/lib/nginx/modules

export ADDNODE_CMD=${COMMON_DIR}/addnode
export SYNCNODE_CMD=${COMMON_DIR}/syncnode
export EXPORTATTACKS_CMD=${COMMON_DIR}/export-attacks

export WALLARM_CONFDIR=${CONFDIR}/wallarm
export WALLARM_NODECONFIG=${WALLARM_CONFDIR}/node.yml
export WALLARM_LICENSEKEY=${WALLARM_CONFDIR}/license.key
export WALLARM_PROTONDB=${WALLARM_CONFDIR}/proton.db
export WALLARM_LOM=${WALLARM_CONFDIR}/lom

export NGINX_CMD=${SBINDIR}/nginx
export NGINX_LOGDIR=${LOGDIR}
export NGINX_CONFDIR=${CONFDIR}/nginx
export NGINX_CONFIG=${NGINX_CONFDIR}/nginx.conf
export NGINX_ACCESSLOG=${NGINX_LOGDIR}/access.log
export NGINX_ERRORLOG=${NGINX_LOGDIR}/error.log

export COLLECTD_CMD=${SBINDIR}/collectd
export COLLECTD_CONFIG=${CONFDIR}/collectd/collectd.conf
export COLLECTD_LIBDIR=${WALLARM_DIR}/lib/collectd
export COLLECTD_PYTHONDIR=${COLLECTD_LIBDIR}/python
export COLLECTD_TYPESDB=${WALLARM_DIR}/share/collectd/types.db

export TARANTOOL_CMD=${BINDIR}/tarantool
export TARANTOOL_HOST=127.0.0.1
export TARANTOOL_PORT=3313
if [ "$PORT" = "$TARANTOOL_PORT" ]; then
	export TARANTOOL_PORT=13313
fi

export WALLARM_BACKEND=${WALLARM_BACKEND:-unix:/tmp/nginx.socket}
case $WALLARM_MODE in
	off|monitoring|block)
		;;
	*)
		if [ -n "$WALLARM_MODE" ]; then
			echo "WARNING: unknown mode \"$WALLARM_MODE\"; assume monitoring"
		fi
		export WALLARM_MODE=monitoring
		;;
esac

export WALLARM_API_HOST=${WALLARM_API_HOST:-api.wallarm.com}
